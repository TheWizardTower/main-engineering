---
 - hosts: localhost
   tasks:
   - name: Ensure docker group is present.
     group: name=docker state=present

   - name: Capture Fedora release number.
     # warn: false # the rpm/dnf module doesn't let us do this, so don't chide us to use it.
     shell: '/bin/rpm -E %fedora'
     args:
       warn: false
     register: rpm_release

   - name: Enable RPMFusion Free
     dnf: name=https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ rpm_release.stdout }}.noarch.rpm       state=latest

   - name: Enable RPMFusion Non-Free
     dnf: name=https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ rpm_release.stdout }}.noarch.rpm state=latest

   - name: Install libselinux.
     dnf:
       name:
         - libselinux-python
         - libselinux-python3
       state: latest

   - name: Enable the Haskell Stack COPR repo.
     shell: 'dnf copr enable petersen/stack -y'
     args:
       warn: false

   - name: Install packaged development tools.
     dnf:
       name:
         - ack
         - asciidoc
         - boost-static
         - colordiff
         - colorgcc
         - cabal-rpm
         - cargo
         - clang
         - cmake
         - clojure
         - cowsay
         - cppcheck
         - emacs
         - dash
         - fish
         - haskell-platform
         - hlint
         - gcc-c++
         - gem
         - git
         - git-extras
         - git-svn
         - golang
         - htop
         - hub
         - iftop
         - iotop
         - irssi
         - lynx
         - mercurial
         - mc
         - most
         - npm
         # - ntop
         - perl-core
         - perl-criticism
         - perltidy
         - php-pear
         - psmisc
         - pv
         - python
         - python3-pip
         - PyYAML
         - rpmlint
         - ruby-devel
         - rust
         - rust-doc
         - rust-lldb
         - rust-src
         - rust-std-static
         - screen
         - stack
         - strace
         - subversion
         - the_silver_searcher
         - tmux
         - vim-enhanced
         - zsh
       state: present


   - name: Install acorn via npm.
     npm:
       name: acorn
       state: latest
       global: false
       path: /home/merlin

   - name: Install eslint via npm.
     npm:
       name: eslint
       state: latest
       global: false
       path: /home/merlin

   - name: Install eslint-config-standard via npm.
     npm:
       name: eslint-config-standard
       state: latest
       global: false
       path: /home/merlin

   - name: Install eslint-plugin-react via npm.
     npm:
       name: eslint-plugin-react
       state: latest
       global: false
       path: /home/merlin

   - name: Install js-beautify via npm.
     npm:
       name: js-beautify
       state: latest
       global: false
       path: /home/merlin

   - name: Install jshint via npm.
     npm:
       name: jshint
       state: latest
       global: false
       path: /home/merlin

   - name: Install standard via npm.
     npm:
       name: standard
       state: latest
       global: false
       path: /home/merlin

   - name: Install tern via npm.
     npm:
       name: tern
       state: latest
       global: false
       path: /home/merlin

   - name: Install Gem package (sqlint).
     gem:
       name: sqlint
       state: latest
       user_install: false

   - name: Install Pear packages (phpcs).
     pear:
       name: PHP_CodeSniffer
       state: latest

   - name: Install pip packages (powerline).
     pip:
       name: powerline-status
       state: latest

   - name: Install -devel packages for threadscope.
     dnf:
       name:
         - cairo-devel
         - glib2-devel
         - gtk2-devel
         - pango-devel
       state: present

   - name: Checkout Dotfiles repo.
     become: true
     become_user: merlin
     git: repo=https://github.com/TheWizardTower/abrazo.git
          dest=/home/merlin/abrazo
          accept_hostkey=yes
          update=no

   - name: Checkout a copy of Spacemacs.
     become: true
     become_user: merlin
     git: repo=https://github.com/syl20bnr/spacemacs.git
          dest=/home/merlin/spacemacs/.emacs.d
          accept_hostkey=true
          update=yes

   - name: Checkout a copy of Tmux Plugin Manager
     become: true
     become_user: merlin
     git:
       repo: https://github.com/tmux-plugins/tpm
       dest: /home/merlin/.tmux/plugins/tpm
       accept_hostkey: true
       update: yes

   - name: Create ~/git
     become: true
     become_user: merlin
     file: path=/home/merlin/git state=directory

   # Need to make the ~/git dir
   - name: Checkout useful git repos.
     become: true
     become_user: merlin
     git: repo={{ item.src }}
          accept_hostkey=true
          dest=/home/merlin/git/{{ item.dest }}
          update=yes 
     with_items:
       - { src: 'https://github.com/Airblader/xcb-util-xrm.git', dest: 'xcb-util-xrm' }
       - { src: 'https://github.com/DanielG/cabal-helper.git', dest: 'cabal-helper' }
       - { src: 'https://github.com/DanielG/ghc-mod.git', dest: 'ghc-mod' }
       - { src: 'https://github.com/LuRsT/hr.git', dest: 'hr' }
       - { src: 'https://github.com/agda/agda.git', dest: 'agda' }
       - { src: 'https://github.com/alanz/HaRe.git', dest: 'HaRe' }
       - { src: 'https://github.com/carlohamalainen/ghc-imported-from', dest: 'ghc-imported-from' }
       - { src: 'https://github.com/creichert/stack-tag.git', dest: 'stack-tag' }
       - { src: 'https://github.com/edc/bass.git', dest: 'bass' }
       - { src: 'https://github.com/favadi/flycheck-gometalinter.git', dest: 'flycheck-gometalinter' }
       - { src: 'https://github.com/garabik/grc.git', dest: 'grc' }
       - { src: 'https://github.com/github/hub.git', dest: 'hub' }
       - { src: 'https://github.com/jonas/tig.git', dest: 'tig' }
       - { src: 'https://github.com/joshuaclayton/unused.git', dest: 'unused' }
       - { src: 'https://github.com/junegunn/fzf.git', dest: 'fzf' }
       - { src: 'https://github.com/kanaka/mal.git', dest: 'mal' }
       - { src: 'https://github.com/kanaka/mal.workshop.git', dest: 'mal.workshop' }
       - { src: 'https://github.com/ndmitchell/ghcid.git', dest: 'ghcid' }
       - { src: 'https://github.com/replicatedhq/dockerfilelint.git', dest: 'dockerfilelint' }
       - { src: 'https://github.com/sboli/twmn.git', dest: 'twmn' }
       - { src: 'https://github.com/tj/git-extras.git', dest: 'git-extras' }
       - { src: 'https://github.com/trapd00r/LS_COLORS.git', dest: 'LS_COLORS' }
       - { src: 'https://github.com/unixorn/git-extra-commands.git', dest: 'git-extra-commands' }
       - { src: 'https://gitlab.com/o9000/tint2.git', dest: 'tint2' }

   - name: Setup bass.
     become: true
     become_user: merlin
     shell: "make install"
     args:
       chdir: /home/merlin/git/bass

   - name: Setup LS_COLORS.
     file:
       path: /home/merlin/.dircolors
       src: /home/merlin/git/LS_COLORS/LS_COLORS
       state: soft
       owner: merlin
       group: merlin

   - name: Setup GRC.
     shell: "/home/merlin/git/grc/install.sh"
     args:
       chdir: /home/merlin/git/grc

   - name: Install hr.
     shell: "make install"
     args:
       chdir: /home/merlin/git/hr

   - name: Build tig.
     become: true
     become_user: merlin
     shell: "make; make install; make install-doc; make install-release-doc"
     args:
       chdir: /home/merlin/git/tig

   - name: Setup abrazo dotfiles repo.
     become: true
     become_user: merlin
     shell: "/home/merlin/dotfiles/install"
     args:
       chdir: /home/merlin/dotfiles
  
   - name: Update packages.
     dnf:
       name=*
       state=latest
  
