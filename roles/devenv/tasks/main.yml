---
 - hosts: localhost
   tasks:
   - name: Ensure docker group is present.
     group: name=docker state=present

   - name: Setup Adobe yum repo.
     shell: '/usr/bin/rpm -ivh http://linuxdownload.adobe.com/adobe-release/adobe-release-x86_64-1.0-1.noarch.rpm ||:'

   - name: Capture Fedora release number.
     shell: '/bin/rpm -E %fedora'
     register: rpm_release

   - name: Enable RPMFusion
     dnf: name=https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ rpm_release.sdtout }}.noarch.rpm state=latest
     dnf: name=https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ rpm_release.stdout }}.noarch.rpm state=latest

   - name: Install libselinux.
     dnf: name={{ item }} state=latest
     with_items:
       - libselinux-python
       - libselinux-python3

   - name: Setup Google Chrome repo file.
     copy: src=~/git/main-engineering/google-chrome.repo dest=/etc/yum.repos.d/google-chrome.repo owner=root group=root mode=0644

   - name: Setup VirtualBox Repo.
     copy: src=~/git/main-engineering/VirtualBox.repo dest=/etc/yum.repos.d/VirtualBox.repo owner=root group=root mode=0644

   - name: Import Google Chrome public key.
     shell: '/bin/rpm --import https://dl-ssl.google.com/linux/linux_signing_key.pub'

   - name: Create a plasma configuration directory.
     become: true
     become_user: amccullough
     shell: '/bin/mkdir -p /home/amccullough/.config/plasma-workspace/env'

   - name: Create a file to set KDEs default window manager to xmonad.
     copy: src=~/git/main-engineering/set_window_manager.sh dest=/home/amccullough/.config/plasma-workspace/env

   - name: Enable the Haskell Stack COPR repo.
     shell: 'dnf copr enable petersen/stack -y'

   - name: Install packaged development tools.
     dnf: name={{ item }} state=present
     with_items:
       - ack
       - colordiff
       - cabal-rpm
       - cargo
       - clojure
       - emacs
       - dash
       - fish
       - haskell-platform
       - hlint
       - git
       - git-svn
       - golang
       - htop
       - levien-inconsolata-fonts
       - iftop
       - iotop
       - irssi
       - lynx
       - mercurial
       - mc
       - ntop
       - perl-core
       - perl-criticism
       - perltidy
       - python
       - PyYAML
       - rpmlint
       - rust
       - screen
       - stack
       - strace
       - subversion
       - the_silver_searcher
       - tmux
       - vim-enhanced
       - vim-X11
       - zsh

   - name: Install -devel packages for threadscope.
     dnf: name={{ item }}
          state=present
   - with_items:
       - cairo-devel
       - glib2-devel
       - gtk2-devel
       - pango-devel

   - name: Install packaged desktop tools.
     dnf: name={{ item }}
          state=present
     with_items:
       - GraphicsMagick
       - ImageMagick
       - NetworkManager-tui
       - VirtualBox-5.1 # Needs the virtualbox repo.
       - amarok-utils
       - cairo-dock
       - cowsay
       - darktable
       - digikam
       - dkms
       - dmenu
       - docker-io
       - dzen2
       - fedup
       - firefox
       - flash-plugin
       - fortune-mod
       - free42
       - gimp
       - google-chrome-stable # Needs the google chrome repo.
       - gparted
       - gpodder
       - imlib2
       - imlib2-devel
       - kernel-devel
       - kernel-headers
       - ksnapshot
       - paman
       - paprefs
       - pavucontrol
       - pavumeter
       - pidgin
       - pidgin-otr
       - plasma-applet-redshift-control
       - purple-plugin-pack
       - pv
       - redshift
       - seamonkey
       - sl
       - steam
       - sysstat
       - tigervnc
       - ufraw
       - unetbootin
       - vlc
       - vnstat
       - xcompmgr
       - xmonad
       - xulrunner
       - yakuake
  
   - name: Checkout Dotfiles repo.
     become: true
     become_user: amccullough
     git: repo=https://github.com/TheWizardTower/dotfiles.git
          dest=/home/amccullough/dotfiles
          accept_hostkey=yes
          update=no

   - name: Checkout a copy of Spacemacs.
     become: true
     become_user: amccullough
     git: repo=https://github.com/syl20bnr/spacemacs.git
          dest=/home/amccullough/spacemacs/.emacs.d
          accept_hostkey=true
          update=yes

   - name: Create ~/git
     become: true
     become_user: amccullough
     file: path=/home/amccullough/git state=directory

   # Need to make the ~/git dir
   - name: Checkout useful git repos.
     become: true
     become_user: amccullough
     git: repo={{ item.src }}
          accept_hostkey=true
          dest=/home/amccullough/git/{{ item.dest }}
          update=yes 
     with_items:
       - { src: 'https://github.com/Airblader/xcb-util-xrm.git', dest: 'xcb-util-xrm' }
       - { src: 'https://github.com/DanielG/cabal-helper.git', dest: 'cabal-helper' }
       - { src: 'https://github.com/DanielG/ghc-mod.git', dest: 'ghc-mod' }
       - { src: 'https://github.com/LuRsT/hr.git', dest: 'hr' }
       - { src: 'https://github.com/agda/agda.git', dest: 'agda' }
       - { src: 'https://github.com/alanz/HaRe.git', dest: 'HaRe' }
       - { src: 'https://github.com/carlohamalainen/ghc-imported-from', dest: 'ghc-imported-from' }
       - { src: 'https://github.com/creichert/stack-tag.git', dest: 'stack-tag' }
       - { src: 'https://github.com/edc/bass.git', dest: 'bass' }
       - { src: 'https://github.com/favadi/flycheck-gometalinter.git', dest: 'flycheck-gometalinter' }
       - { src: 'https://github.com/garabik/grc.git', dest: 'grc' }
       - { src: 'https://github.com/github/hub.git', dest: 'hub' }
       - { src: 'https://github.com/jonas/tig.git', dest: 'tig' }
       - { src: 'https://github.com/junegunn/fzf.git', dest: 'fzf' }
       - { src: 'https://github.com/kanaka/mal.git', dest: 'mal' }
       - { src: 'https://github.com/kanaka/mal.workshop.git', dest: 'mal.workshop' }
       - { src: 'https://github.com/powerline/fonts.git', dest: 'fonts' }
       - { src: 'https://github.com/replicatedhq/dockerfilelint.git', dest: 'dockerfilelint' }
       - { src: 'https://github.com/sboli/twmn.git', dest: 'twmn' }
       - { src: 'https://github.com/thestinger/termite.git', dest: 'termite' }
       - { src: 'https://github.com/thestinger/vte-ng.git', dest: 'vte-ng' }
       - { src: 'https://github.com/tj/git-extras.git', dest: 'git-extras' }
       - { src: 'https://github.com/unixorn/git-extra-commands.git', dest: 'git-extra-commands' }
       - { src: 'https://gitlab.com/o9000/tint2.git', dest: 'tint2' }

   - name: Setup dotfiles repo.
     become: true
     become_user: amccullough
     shell: "/home/amccullough/dotfiles/install.sh"
     args:
       chdir: /home/amccullough/dotfiles
  
   - name: Update packages.
     dnf: name=* state=latest
  
